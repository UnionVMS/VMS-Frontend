<div class="realtime-container">
  <div class="map-container">
    <div id="realtime-map"></div>
    <map-top-panel
      [autocompleteFunction]="searchAutocomplete"
      [autocompleteResult]="searchAutocompleteAsset$ | async"
      [centerMapOnPosition]="centerMapOnPosition"
      [filterFunction]="filterAssets"
      [selectAsset]="selectAsset"
      [currentControlPanel]="mapSettings.currentControlPanel"
      [setCurrentControlPanel]="setCurrentControlPanel"
    >
      <div id="mouse-position"></div>
    </map-top-panel>
    <map-assets
      *ngIf="registerOnSelectFunction !== undefined"
      [assets]="assetMovements"
      [selectedAssets]="selectedAssets$|async"
      [map]="map"
      [mapZoom]="mapZoom"
      [namesVisible]="mapSettings.namesVisible"
      [speedsVisible]="mapSettings.speedsVisible"
      [selectAsset]="selectAsset"
      [shipColorLogic]="mapSettings.assetColorMethod"
      [registerOnSelectFunction]="registerOnSelectFunction"
      [unregisterOnSelectFunction]="unregisterOnSelectFunction"
    ></map-assets>
    <map-tracks
      *ngIf="mapSettings.tracksVisible && mapZoom > 5"
      [assetTracks]="assetTracks$|async"
      [map]="map"
      [mapZoom]="mapZoom"
      [registerOnSelectFunction]="registerOnSelectFunction"
      [unregisterOnSelectFunction]="unregisterOnSelectFunction"
      [addPositionForInspection]="addPositionForInspection"
      [positionsForInspection]="positionsForInspection$|async"
      [registerOnHoverFunction]="registerOnHoverFunction"
      [unregisterOnHoverFunction]="unregisterOnHoverFunction"
    ></map-tracks>
    <map-flagstates
      *ngIf="mapSettings.flagsVisible && mapZoom > 9 && registerOnSelectFunction !== undefined"
      [assets]="assetMovements"
      [map]="map"
      [selectAsset]="selectAsset"
      [registerOnSelectFunction]="registerOnSelectFunction"
      [unregisterOnSelectFunction]="unregisterOnSelectFunction"
    ></map-flagstates>
    <map-information-panel></map-information-panel>
    <map-track-panel
      [positions]="positionsForInspection$|async"
      [removePositionForInspection]="removePositionForInspection"
    ></map-track-panel>
    <map-asset-forecast
      *ngIf="mapSettings.forecastsVisible && mapZoom > 9"
      [map]="map"
      [assetMovements]="forecasts$|async"
      [forecastInterval]="mapSettings.forecastInterval"
    ></map-asset-forecast>
  </div>
  <map-layer-filter
    [mapSettings]="mapSettings"
    [setVisibilityForAssetNames]="setVisibilityForAssetNames"
    [setVisibilityForAssetSpeeds]="setVisibilityForAssetSpeeds"
    [setVisibilityForFlags]="setVisibilityForFlags"
    [setVisibilityForTracks]="setVisibilityForTracks"
    [setVisibilityForForecast]="setVisibilityForForecast"
    [flagsDisabled]="mapZoom < 10"
    [tracksDisabled]="mapZoom < 10"
    [namesDisabled]="mapZoom < 10"
    [speedsDisabled]="mapZoom < 10"
    [forecastsDisabled]="mapZoom < 10"
    [map]="map"
    [saveViewport]="saveViewport"
  ></map-layer-filter>
  <map-asset-panel
    *ngIf="(selectedAssets$|async).length > 0"
    [assets]="selectedAssets$|async"
    [selectAsset]="selectAsset"
    [deselectAsset]="deselectAsset"
    [forecasts]="forecasts$|async"
    [getAssetTrack]="getAssetTrack"
    [getAssetTrackFromTime]="getAssetTrackFromTime"
    [untrackAsset]="untrackAsset"
    [addForecast]="addForecast"
    [removeForecast]="removeForecast"
    [tracksMinuteCap]="mapSettings.tracksMinuteCap"
    [centerMapOnPosition]="centerMapOnPosition"
  ></map-asset-panel>
  <div class="control-panel">
    <map-control-panel
      *ngIf="mapSettings.currentControlPanel === 'map-control-panel'"
      [mapSettings]="mapSettings"
      [setTracksMinuteCap]="setTracksMinuteCap"
      [setForecastInterval]="setForecastInterval"
      [clearTracks]="clearTracks"
      [clearForecasts]="clearForecasts"
    ></map-control-panel>
    <map-distance-between-points
      *ngIf="map !== undefined"
      [map]="map"
      [registerOnClickFunction]="registerOnClickFunction"
      [active]="mapSettings.currentControlPanel === 'map-distance-between-points'"
    ></map-distance-between-points>
    <map-saved-filters
      *ngIf="mapSettings.currentControlPanel === 'map-saved-filters'"
      [filterQuery]="currentFilterQuery$ | async"
      [addSavedFilter]="addSavedFilter"
      [savedFilters]="savedFilters$ | async"
      [activeFilters]="activeFilterNames$ | async"
      [activateFilter]="activateSavedFilter"
      [deactivateFilter]="deactivateSavedFilter"
    ></map-saved-filters>
    <map-asset-groups
      *ngIf="mapSettings.currentControlPanel === 'map-asset-groups'"
      [assetGroups]="assetGroups$ | async"
      [selectedAssetGroups]="selectedAssetGroups$ | async"
      [setAssetGroup]="setAssetGroup"
      [clearAssetGroup]="clearAssetGroup"
    ></map-asset-groups>
    <map-layers
      *ngIf="(authToken$ | async) !== undefined && (mapLayers$ | async).length > 0"
      [map]="map"
      [authToken]="authToken$ | async"
      [mapLayers]="mapLayers$ | async"
      [activeMapLayers]="activeMapLayers$ | async"
      [menuActive]="mapSettings.currentControlPanel === 'map-layers'"
      [addActiveLayerFunction]="addActiveLayer"
      [removeActiveLayerFunction]="removeActiveLayer"
    ></map-layers>
  </div>
</div>
